{% extends "django_classified/_base.html" %}
{% load i18n %}

{% block title %}Pagamento Completato - {{ transaction.item.title }}{% endblock %}

{% block body %}
<div class="container" style="max-width: 700px;">
    
    <!-- Messaggio di successo principale -->
    <div class="text-center mb-4">
        <div class="alert alert-success border-success">
            <h1 class="display-4 text-success">ğŸ‰</h1>
            <h2 class="text-success mb-3">Pagamento Completato!</h2>
            <p class="lead">Il tuo acquisto Ã¨ stato elaborato con successo.</p>
        </div>
    </div>

    <!-- Dettagli transazione -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5>âœ… Dettagli Transazione</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>ID Transazione:</strong><br>
                       <code>{{ transaction.uuid.hex|slice:":8"|upper }}</code></p>
                    <p><strong>Data:</strong><br>
                       {{ transaction.completed_at|date:"d/m/Y H:i" }}</p>
                    <p><strong>Importo Pagato:</strong><br>
                       <span class="text-success h5">â‚¬{{ transaction.total_amount_euros|floatformat:2 }}</span></p>
                </div>
                <div class="col-md-6">
                    <p><strong>Venditore:</strong><br>
                       {{ transaction.seller.username }}</p>
                    <p><strong>Metodo di Pagamento:</strong><br>
                       ğŸ’³ Carta di Credito/Debito</p>
                    <p><strong>Stato:</strong><br>
                       <span class="badge badge-success">{{ transaction.get_status_display }}</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dettagli articolo acquistato -->
    <div class="card mb-4">
        <div class="card-header">
            <h5>ğŸ® Articolo Acquistato</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    {% if transaction.item.image_set.first %}
                        <img src="{{ transaction.item.image_set.first.file.url }}" 
                             alt="{{ transaction.item.title }}" 
                             class="img-fluid rounded">
                    {% else %}
                        <div class="bg-light p-4 text-center rounded text-muted">
                            <i class="fas fa-gamepad fa-3x"></i><br>
                            {{ transaction.item.title }}
                        </div>
                    {% endif %}
                </div>
                <div class="col-md-8">
                    <h5>{{ transaction.item.title }}</h5>
                    <p><strong>Prezzo:</strong> â‚¬{{ transaction.item_price_euros|floatformat:2 }}</p>
                    {% if transaction.item.description %}
                        <p class="text-muted">{{ transaction.item.description|truncatewords:25 }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Informazioni di consegna -->
    {% if transaction.shipping_address %}
        <div class="card mb-4">
            <div class="card-header">
                <h5>ğŸ“¦ Informazioni di Consegna</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>ğŸ“ Indirizzo di Spedizione:</h6>
                        <div class="alert alert-light">
                            {{ transaction.shipping_address|linebreaks }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>ğŸ‘¤ Destinatario:</h6>
                        <p>{{ transaction.buyer_name|default:transaction.buyer.username }}<br>
                           <small class="text-muted">{{ transaction.buyer_email }}</small></p>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Prossimi passi -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5>ğŸ“‹ Prossimi Passi</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>ğŸ”„ Per Te (Acquirente):</h6>
                    <ul>
                        <li>âœ… Pagamento completato con successo</li>
                        <li>ğŸ“§ Riceverai una email di conferma</li>
                        <li>â³ Attendi la consegna dall'venditore</li>
                        <li>â­ Lascia un feedback dopo aver ricevuto l'articolo</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>ğŸª Per il Venditore:</h6>
                    <ul>
                        <li>ğŸ“§ Ha ricevuto notifica del pagamento</li>
                        <li>ğŸ“¦ OrganizzerÃ  la consegna/spedizione</li>
                        <li>ğŸ’° RiceverÃ  il pagamento entro 2-7 giorni</li>
                        <li>ğŸ“± Potrai contattarlo per organizzare la consegna</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Contatti venditore per organizzare consegna -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h5>ğŸ“ Organizza la Consegna</h5>
        </div>
        <div class="card-body">
            <p><strong>Contatta il venditore per organizzare la consegna:</strong></p>
            
            <div class="row">
                <div class="col-md-6">
                    <p><strong>ğŸ‘¤ {{ transaction.seller.username }}</strong></p>
                    <p>ğŸ“§ Email: <a href="mailto:{{ transaction.seller.email }}">{{ transaction.seller.email }}</a></p>
                    
                    {% if transaction.seller.trade_profile_extended.phone_number and transaction.seller.trade_profile_extended.show_phone_in_trades %}
                        <p>ğŸ“± Telefono: 
                           <a href="tel:{{ transaction.seller.trade_profile_extended.phone_number }}">
                               {{ transaction.seller.trade_profile_extended.phone_number }}
                           </a>
                        </p>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    {% if transaction.seller.trade_profile_extended.location %}
                        <p><strong>ğŸ“ Zona:</strong> {{ transaction.seller.trade_profile_extended.location }}</p>
                    {% endif %}
                    
                    <div class="alert alert-info">
                        <small>
                            <strong>ğŸ’¡ Suggerimento:</strong> 
                            Contatta il venditore entro 24-48 ore per organizzare 
                            modalitÃ  e tempi di consegna.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Azioni -->
    <div class="text-center mb-4">
        <div class="btn-group btn-group-lg" role="group">
            <a href="{% url 'payments:purchase_history' %}" class="btn btn-primary">
                ğŸ“‹ I Miei Acquisti
            </a>
            <a href="{% url 'django_classified:index' %}" class="btn btn-success">
                ğŸ  Torna alla Home
            </a>
            <a href="{% url 'django_classified:search' %}" class="btn btn-outline-primary">
                ğŸ” Altri Articoli
            </a>
        </div>
    </div>

    <!-- Supporto -->
    <div class="alert alert-light border">
        <div class="text-center">
            <h6>â“ Hai bisogno di aiuto?</h6>
            <p class="mb-2">
                Per qualsiasi problema o domanda, contatta il nostro supporto:
            </p>
            <p class="mb-0">
                ğŸ“§ <a href="mailto:support@ninvendo.com">support@ninvendo.com</a> â€¢ 
                ğŸ“± WhatsApp: +39 123 456 7890
            </p>
        </div>
    </div>

</div>

<!-- Script per tracking conversioni (opzionale) -->
<script>
// Google Analytics Enhanced Ecommerce (se configurato)
// gtag('event', 'purchase', {
//     transaction_id: '{{ transaction.uuid.hex|slice:":8" }}',
//     value: {{ transaction.total_amount_euros }},
//     currency: 'EUR',
//     items: [{
//         item_id: '{{ transaction.item.id }}',
//         item_name: '{{ transaction.item.title|escapejs }}',
//         category: '{{ transaction.item.group.name|default:"Nintendo"|escapejs }}',
//         quantity: 1,
//         price: {{ transaction.item_price_euros }}
//     }]
// });

// Facebook Pixel (se configurato)
// fbq('track', 'Purchase', {
//     value: {{ transaction.total_amount_euros }},
//     currency: 'EUR'
// });

console.log('ğŸ‰ Pagamento completato con successo!');
console.log('Transazione:', '{{ transaction.uuid.hex|slice:":8" }}');
</script>
{% endblock %}