# Project Snapshot (Django)

- Root: `C:\Users\riki_\Documents\GitHub\NINVENDO-django-classified-demo`
- Generated by: `snapshot_django.py`

---

## Project Tree (compact)

```
NINVENDO-django-classified-demo/
├── demo/
│   ├── craigslist_data/
│   │   ├── Areas.json
│   │   ├── Categories.json
│   │   └── Types.json
│   ├── management/
│   │   └── commands/
│   ├── templates/
│   │   └── demo/
│   ├── __init__.py
│   └── tests.py
├── out/
│   ├── CONTEXT.md
│   └── GIT_HISTORY.txt
├── project/
│   ├── templatetags/
│   │   ├── __init__.py
│   │   └── site_tags.py
│   ├── context_processors.py
│   ├── settings.py
│   └── urls.py
├── templates/
│   ├── django_classified/
│   │   ├── _base.html
│   │   ├── item_detail.html
│   │   ├── item_form.html
│   │   ├── item_list.html
│   │   ├── login.html
│   │   ├── password_reset_complete.html
│   │   ├── password_reset_confirm.html
│   │   ├── password_reset_done.html
│   │   ├── password_reset_email.txt
│   │   ├── password_reset_form.html
│   │   ├── password_reset_subject.txt
│   │   ├── profile.html
│   │   ├── search.html
│   │   └── section_list.html
│   ├── registration/
│   │   ├── registration_complete.html
│   │   └── registration_form.html
│   └── base.html
├── trade/
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── list.html
│   ├── models.py
│   ├── propose.html
│   ├── tests.py
│   ├── urls.py
│   └── views.py
├── __init__.py
├── app.json
├── customize_templates.py
├── db.sqlite
├── db.sqlite3
├── fix_templates.py
├── LICENSE
├── list_html.txt
├── list_py.txt
├── manage.py
├── Procfile
├── proj_snapshot.py
├── README.md
├── requirements.txt
├── runtime.txt
├── setup_site.py
└── wsgi.py
```


---

## Git History (last 50 commits)

```
1c788d0 | 2025-08-31 | riccardo74 | Move registration templates and add base.html bridge
eff7548 | 2025-08-31 | riccardo74 | Add trade (barter) module with user proposals
1f7483b | 2025-08-31 | riccardo74 | Add NINVENDO branding and dynamic site config support
eea7fe8 | 2025-08-31 | riccardo74 | Add list_html.txt and list_py.txt files
a484832 | 2025-08-31 | riccardo74 | Set local memory cache backend for development
48bd3b2 | 2025-04-03 | dependabot[bot] | Bump django from 5.1.7 to 5.1.8 (#173)
11cf76a | 2025-03-11 | dependabot[bot] | Bump django from 5.1.5 to 5.1.7 (#172)
6f541c1 | 2025-01-26 | dependabot[bot] | Bump django from 5.1.4 to 5.1.5 (#168)
ed34e86 | 2025-01-06 | Sergey Lyapustin | Update deployment template to use repo_clone_url instead of github
1d50510 | 2025-01-05 | Sergey Lyapustin | Digital Ocean deployment button (#166)
3187eb1 | 2025-01-05 | Sergey Lyapustin | Update project configuration and dependencies
36aba25 | 2023-07-25 | Sergey Lyapustin | Merge pull request #163 from slyapustin/dependabot/pip/django-3.2.18
7c01deb | 2023-07-25 | Sergey Lyapustin | Merge pull request #164 from slyapustin/dokku
859b9ec | 2023-07-25 | Sergey Lyapustin | Set DEFAULT_AUTO_FIELD config option.
56f95cd | 2023-07-25 | Sergey Lyapustin | Updated Python version.
d8cc25f | 2023-02-15 | dependabot[bot] | Bump django from 3.2.15 to 3.2.18
3c799bf | 2022-08-11 | Sergey Lyapustin | Merge pull request #159 from slyapustin/dependabot/pip/django-3.2.15
251e0e3 | 2022-08-11 | dependabot[bot] | Bump django from 3.2.14 to 3.2.15
b9de3ef | 2022-07-17 | Sergey Lyapustin | Updated Python
c74a3a1 | 2022-07-17 | Sergey Lyapustin | Merge branch 'master' of github.com:inoks/django-classified-demo
d3f2eb3 | 2022-07-17 | Sergey Lyapustin | Updated Packages.
0c49ac9 | 2022-05-07 | Sergey Lyapustin | Merge pull request #158 from slyapustin/dependabot/pip/django-3.1.14
965588c | 2022-05-07 | dependabot[bot] | Bump django from 3.1.13 to 3.1.14
5d17ec8 | 2022-05-07 | Sergey Lyapustin | Merge pull request #145 from slyapustin/dependabot/pip/django-3.1.13
3769a97 | 2021-09-22 | dependabot[bot] | Bump django from 3.0.9 to 3.1.13
6f5633d | 2020-12-23 | Sergey Lyapustin | Merge pull request #109 from slyapustin/pyup-update-whitenoise-5.1.0-to-5.2.0
1440971 | 2020-12-23 | Sergey Lyapustin | Merge pull request #112 from slyapustin/pyup-update-psycopg2-binary-2.8.5-to-2.8.6
3841296 | 2020-12-23 | Sergey Lyapustin | Merge pull request #114 from praveenmylavarapu/master
1a291c5 | 2020-12-17 | Sergey Lyapustin | Merge pull request #118 from slyapustin/pyup-update-django-storages-1.9.1-to-1.11
0f34723 | 2020-12-17 | pyup-bot | Update django-storages from 1.9.1 to 1.11
50e6a40 | 2020-10-01 | Praveen Mylavarapu | Read .env file
2132003 | 2020-09-07 | pyup-bot | Update psycopg2-binary from 2.8.5 to 2.8.6
c8d73c9 | 2020-08-04 | pyup-bot | Update whitenoise from 5.1.0 to 5.2.0
fa4bd1d | 2020-08-04 | Sergey Lyapustin | Merge pull request #107 from slyapustin/pyup-update-django-3.0.7-to-3.0.9
72d7097 | 2020-08-03 | pyup-bot | Update django from 3.0.7 to 3.0.9
32a72b2 | 2020-06-04 | Sergey Lyapustin | Merge pull request #104 from slyapustin/pyup-update-django-3.0.6-to-3.0.7
58b54dd | 2020-06-03 | pyup-bot | Update django from 3.0.6 to 3.0.7
6ec458d | 2020-05-21 | Sergey Lyapustin | Merge pull request #102 from slyapustin/pyup-update-whitenoise-5.0.1-to-5.1.0
2614398 | 2020-05-20 | pyup-bot | Update whitenoise from 5.0.1 to 5.1.0
81ccf2a | 2020-05-04 | Sergey Lyapustin | Merge pull request #98 from slyapustin/pyup-update-django-3.0.5-to-3.0.6
4f521ec | 2020-05-04 | pyup-bot | Update django from 3.0.5 to 3.0.6
7976582 | 2020-04-17 | Sergey Lyapustin | Updated Github username
23fda2a | 2020-04-06 | Sergey Lyapustin | Merge pull request #97 from slyapustin/pyup-update-psycopg2-binary-2.8.4-to-2.8.5
3b21409 | 2020-04-06 | pyup-bot | Update psycopg2-binary from 2.8.4 to 2.8.5
d73b732 | 2020-04-01 | Sergey Lyapustin | Merge pull request #96 from slyapustin/pyup-update-django-3.0.4-to-3.0.5
3ad81f1 | 2020-04-01 | pyup-bot | Update django from 3.0.4 to 3.0.5
1a02004 | 2020-03-04 | Sergey Lyapustin | Merge pull request #95 from slyapustin/pyup-update-django-3.0.3-to-3.0.4
2842e25 | 2020-03-04 | pyup-bot | Update django from 3.0.3 to 3.0.4
2c1e571 | 2020-03-04 | Sergey Lyapustin | Update README.md
079afd6 | 2020-02-23 | Sergey Lyapustin | Removed email/password auth as it required a bit more work in order to make it secure.
```


---

## Key Files (redacted excerpts)


### manage.py

```python
#!/usr/bin/env python
import os
import sys

if __name__ == "__main__":
    os.environ.setdefault("DJANGO_SETTINGS_MODULE", "project.settings")

    from django.core.management import execute_from_command_line

    execute_from_command_line(sys.argv)
```


### Procfile

```
web: gunicorn wsgi:application
release: python manage.py migrate --noinput
```


### README.md

```
# Django Classified Demo website

[Django-classified](https://github.com/slyapustin/django-classified) demo project with user authorization via Facebook or Email.

## Deploy to DigitalOcean

Click the button below to deploy the Django Classified Demo app to DigitalOcean:

[![Deploy to DO](https://www.deploytodo.com/do-btn-blue.svg)](https://cloud.digitalocean.com/apps/new?repo=https://github.com/slyapustin/django-classified-demo/tree/master&refcode=08ce1ee690de)

Use username `admin` and password `admin` to login to the admin panel.

## Customization

- Note: `python ./manage.py setup_project` command will load initial data to populate app Sections, Groups and Areas based on [craigslist.org](http://craigslist.org) website structure.

## Run locally

Create `.env ` file with your local settings (use `.env.example` as an example).

- Create Virtual Environment and install requirements via `pip install -r requirements.txt`.
- Create initial database schema `python ./manage.py migrate`
- Collect static files `python ./manage.py collectstatic`
- Start local development server `python ./manage.py runserver`
- Visit http://127.0.0.1:8000/
```


### requirements.txt

```
boto3==1.35.92  # pyup: ignore
django-classified==1.1.1
django-environ==0.11.2
django==5.1.8
gunicorn==23.0.0
psycopg2-binary==2.9.10
python-memcached==1.62
social-auth-app-django==5.4.2
whitenoise==6.8.2
django-fsm==3.0.0
```


### demo/templates/demo/login.html

```html
{% extends 'django_classified/_base.html' %}

{% load i18n %}

{% block title %}{% trans "Login" %}{% endblock title %}

{% block body %}

  <div class="row">
    <div class="col-lg-12">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">{% trans "Login" %}</h4>
          </div>
          <div class="modal-body">
            <ul>
              <li><a href="{% url "social:begin" "facebook" %}">Facebook</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

{% endblock %}
```


### project/settings.py

```python
# -*- coding:utf-8 -*-
import os

import environ

BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

env = environ.Env(
    DEBUG=(bool, False),
    CACHE_URL=(str, 'locmemcache://'),
    EMAIL_URL=(str, 'consolemail://'),
    SECRET_KEY=(str, 'secret'),
    DATABASE_URL=(str, 'sqlite:///db.sqlite'),
)

env.read_env(str(os.path.join(BASE_DIR, ".env")))

DEBUG = env('DEBUG')
SECRET_KEY = env('SECRET_KEY')


ADMINS = (
    ('Demo Classified Admin', os.environ.get('ADMIN_EMAIL', '***REDACTED***')),
)

MANAGERS = ADMINS

# Expected comma separated string with the ALLOWED_HOSTS list
ALLOWED_HOSTS = os.environ.get('ALLOWED_HOSTS', '***REDACTED***').split(',')

# (Opzionale ma utile in deploy dietro proxy/Render per OAuth)
# Comma-separated, es: "https://nintendo-swap.onrender.com"
CSRF_TRUSTED_ORIGINS = os.environ.get('CSRF_TRUSTED_ORIGINS', '***REDACTED***') if os.environ.get('CSRF_TRUSTED_ORIGINS') else []

DATABASES = {
    'default': env.db(),
}

# Cache configuration for development
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
        'LOCATION': 'default-cache',
        'OPTIONS': {
            'MAX_ENTRIES': 1000,
            'CULL_FREQUENCY': 3,
        }
    }
}

# Local time zone for this installation. Choices can be found here:
# http://en.wikipedia.org/wiki/List_of_tz_zones_by_name
# although not all choices may be available on all operating systems.
# On Unix systems, a value of None will cause Django to use the same
# timezone as the operating system.
# If running in a Windows environment this must be set to the same as your
# system time zone.
TIME_ZONE = 'UTC'

# Language code for this installation. All choices can be found here:
# http://www.i18nguy.com/unicode/language-identifiers.html
LANGUAGE_CODE = 'en-us'

SITE_ID = 1

# If you set this to False, Django will make some optimizations so as not
# to load the internationalization machinery.
USE_I18N = True

# If you set this to False, Django will not format dates, numbers and
# calendars according to the current locale
USE_L10N = True

USE_TZ = True
# Absolute filesystem path to the directory that will hold user-uploaded files.
# Example: '/home/media/media.lawrence.com/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# URL that handles the media served from MEDIA_ROOT. Make sure to use a
# trailing slash.
# Examples: 'http://media.lawrence.com/media/', 'http://example.com/media/'
MEDIA_URL = "/media/"

# Absolute path to the directory static files should be collected to.
# Don't put anything in this directory yourself; store your static files
# in apps' 'static/' subdirectories and in STATICFILES_DIRS.
# Example: '/home/media/media.lawrence.com/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'static')

# URL prefix for static files.
# Example: 'http://media.lawrence.com/static/'
STATIC_URL = '/static/'

# URL prefix for admin static files -- CSS, JavaScript and images.
# Make sure to use a trailing slash.
# Examples: 'http://foo.com/static/admin/', '/static/admin/'.

# Additional locations of static files
STATICFILES_DIRS = (

    # Put strings here, like '/home/html/static' or 'C:/www/django/static'.
    # Always use forward slashes, even on Windows.
    # Don't forget to use absolute paths, not relative paths.
)

STORAGES = {
    "default": {
        "BACKEND": "django.core.files.storage.FileSystemStorage",
    },
    "staticfiles": {
        "BACKEND": "whitenoise.storage.CompressedManifestStaticFilesStorage",
    },
}

MIDDLEWARE = (
    'whitenoise.middleware.WhiteNoiseMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.locale.LocaleMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
)

# 🔐 Backends: Google OAuth2 + username/password Django (e manteniamo Facebook se già configurato)
AUTHENTICATION_BACKENDS = (
    'social_core.backends.google.GoogleOAuth2',     # Google Login
    'social_core.backends.facebook.FacebookOAuth2', # (opzionale) Facebook già presente
    'django.contrib.auth.backends.ModelBackend',    # Username/Password nativo Django
)

ROOT_URLCONF = 'project.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'APP_DIRS': True,
        'DIRS': [os.path.join(BASE_DIR, 'templates')],
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',

                # Social Auth context processors
                'social_django.context_processors.backends',
                'social_django.context_processors.login_redirect',

                # Django Classified context processors
                'django_classified.context_processors.common_values'
            ],
            'debug': True
        },
    },
]

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.humanize',
    'django.contrib.messages',
    'django.contrib.sessions',
    'django.contrib.sitemaps',
    'django.contrib.sites',
    'django.contrib.staticfiles',

    'bootstrapform',
    'sorl.thumbnail',
    'django_classified',
    'social_django',

    'demo',
    'registration',  

    "trade"
]

ACCOUNT_ACTIVATION_DAYS = 7  # per backend 'default' (con email)


LOGIN_REDIRECT_URL = '/'
LOGIN_URL = '/login/'
LOGOUT_REDIRECT_URL = '/'

DCF_SITE_NAME = 'NinVendo : a place for NinTendo lovers'

# ---- Social Auth: Google (aggiunto) ----
# Imposta questi valori nell'ambiente (.env o Render env)
SOCIAL_AUTH_GOOGLE_OAUTH2_KEY = '***REDACTED***'SOCIAL_AUTH_GOOGLE_OAUTH2_KEY')
SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET = '***REDACTED***'SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET')

# Se sei dietro proxy/https terminato a monte (es. Render), abilita il redirect HTTPS:
# In locale lascialo False; in produzione metti env SOCIAL_AUTH_REDIRECT_IS_HTTPS='***REDACTED***'
SOCIAL_AUTH_REDIRECT_IS_HTTPS = '***REDACTED***'SOCIAL_AUTH_REDIRECT_IS_HTTPS', default=False)

# ---- Social Auth: Facebook (già presente, opzionale) ----
# You need to obtain Facebook Keys
# Check docs for more info here:
# https://python-social-auth.readthedocs.io/en/latest/backends/facebook.html
SOCIAL_AUTH_FACEBOOK_KEY = '***REDACTED***'SOCIAL_AUTH_FACEBOOK_KEY')
SOCIAL_AUTH_FACEBOOK_SECRET = '***REDACTED***'SOCIAL_AUTH_FACEBOOK_SECRET')
SOCIAL_AUTH_FACEBOOK_SCOPE = '***REDACTED***'email']
SOCIAL_AUTH_FACEBOOK_PROFILE_EXTRA_PARAMS = '***REDACTED***'
    'fields': 'id, name, email'
}

SOCIAL_AUTH_EMAIL_FORM_HTML = '***REDACTED***'
SOCIAL_AUTH_EMAIL_VALIDATION_URL = '***REDACTED***'

SOCIAL_AUTH_PIPELINE = '***REDACTED***'
    'social_core.pipeline.social_auth.social_details',
    'social_core.pipeline.social_auth.social_uid',
    'social_core.pipeline.social_auth.auth_allowed',
    'social_core.pipeline.social_auth.social_user',
    'social_core.pipeline.user.get_username',
    'social_core.pipeline.mail.mail_validation',
    'social_core.pipeline.user.create_user',
    'social_core.pipeline.social_auth.associate_user',
    'social_core.pipeline.debug.debug',
    'social_core.pipeline.social_auth.load_extra_data',
    'social_core.pipeline.user.user_details',
    'social_core.pipeline.debug.debug'
)

DEFAULT_FROM_EMAIL = os.environ.get('DEFAULT_FROM_EMAIL', '***REDACTED***')

DEFAULT_AUTO_FIELD = 'django.db.models.AutoField'

# Configure email Backend via EMAIL_URL
vars().update(env.email_url())

DCF_CURRENCY = 'EUR'
DCF_DISPLAY_EMPTY_GROUPS = True
GOOGLE_ANALYTICS_PROPERTY_ID = os.environ.get('GOOGLE_ANALYTICS_PROPERTY_ID')
```


### project/urls.py

```python
from django.urls import include, re_path, path
from django.contrib import admin
from django.contrib.auth import views as auth_views
from django.views.generic import TemplateView
from django.conf.urls.static import static
from django.conf import settings

urlpatterns = [
    re_path('', include('django_classified.urls', namespace='django_classified')),
    re_path('social/', include('social_django.urls', namespace='social')),
    path('admin/', admin.site.urls),

    # Auth base
    path('login/', auth_views.LoginView.as_view(template_name='django_classified/login.html'), name='login'),
    path('logout/', auth_views.LogoutView.as_view(next_page='/'), name='logout'),

    # Password reset (flow completo)
    path('password-reset/', auth_views.PasswordResetView.as_view(
        template_name='django_classified/password_reset_form.html',
        email_template_name='django_classified/password_reset_email.txt',
        subject_template_name='django_classified/password_reset_subject.txt',
        success_url='/password-reset/done/'
    ), name='password_reset'),

    path('password-reset/done/', auth_views.PasswordResetDoneView.as_view(
        template_name='django_classified/password_reset_done.html'
    ), name='password_reset_done'),

    path('reset/<uidb64>/<token>/', auth_views.PasswordResetConfirmView.as_view(
        template_name='django_classified/password_reset_confirm.html',
        success_url='/reset/done/'
    ), name='password_reset_confirm'),

    path('reset/done/', auth_views.PasswordResetCompleteView.as_view(
        template_name='django_classified/password_reset_complete.html'
    ), name='password_reset_complete'),

    # Pagina usata da social auth (se serve)
    path('email-sent/', TemplateView.as_view(template_name='django_classified/email_sent.html'), name='email_sent'),

    # Registrazione utenti (django-registration-redux, backend simple)
    path('accounts/', include('registration.backends.simple.urls')),

    # Modulo "baratto"
    path('trade/', include('trade.urls', namespace='trade')),
]

urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```


### templates/base.html

```html
{% extends "django_classified/_base.html" %}

{# This template serves as a bridge between django-registration 
   and your existing _base.html template structure #}
```


### templates/django_classified/login.html

```html
{% extends "django_classified/_base.html" %}
{% load i18n %}

{% block title %}Login{% endblock %}

{% block body %}
<div class="container" style="max-width:400px;margin-top:30px">
  <h3>Accedi</h3>

  <!-- Form username/password -->
  <form method="post" action="{% url 'login' %}">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="form-group">
      <label for="id_username">{% trans "Username" %}</label>
      {{ form.username }} {{ form.username.errors }}
    </div>

    <div class="form-group">
      <label for="id_password">{% trans "Password" %}</label>
      {{ form.password }} {{ form.password.errors }}
    </div>

    <button type="submit" class="btn btn-primary btn-block">{% trans "Entra" %}</button>
  </form>

  <!-- Link reset password -->
  <div style="margin-top:10px;">
    <a href="{% url 'password_reset' %}">{% trans "Password dimenticata?" %}</a>
  </div>

  <!-- Link registrazione -->
  <div style="margin-top:10px;">
    <a href="{% url 'registration_register' %}">{% trans "Non hai un account? Registrati" %}</a>
  </div>

  <hr>

  <!-- Login con Google -->
  <div style="text-align:center;margin-bottom:8px;">
    <a class="btn btn-default" href="{% url 'social:begin' 'google-oauth2' %}?next=/">
      <img src="https://developers.google.com/identity/images/g-logo.png" 
           alt="Google" style="height:18px;vertical-align:middle;margin-right:6px;">
      Accedi con Google
    </a>
  </div>

  <!-- Login con Facebook -->
  <div style="text-align:center;">
    <a class="btn btn-default" href="{% url 'social:begin' 'facebook' %}?next=/">
      Accedi con Facebook
    </a>
  </div>
</div>
{% endblock %}
```


### templates/django_classified/password_reset_complete.html

```html
{% extends "django_classified/_base.html" %}
{% block title %}Password aggiornata{% endblock %}
{% block body %}
<h3>Password aggiornata</h3>
<p>Ora puoi effettuare l’accesso con la nuova password.</p>
<a class="btn btn-default" href="{% url 'login' %}">Vai al login</a>
{% endblock %}
```


### templates/django_classified/password_reset_confirm.html

```html
{% extends "django_classified/_base.html" %}
{% block title %}Imposta nuova password{% endblock %}
{% block body %}
<h3>Imposta una nuova password</h3>
{% if validlink %}
  <form method="post">
    {% csrf_token %}
    {{ form.non_field_errors }}
    <div class="form-group">
      <label for="id_new_password1">Nuova password</label>
      {{ form.new_password1 }}
      {{ form.new_password1.errors }}
    </div>
    <div class="form-group">
      <label for="id_new_password2">Conferma</label>
      {{ form.new_password2 }}
      {{ form.new_password2.errors }}
    </div>
    <button class="btn btn-primary" type="submit">Aggiorna password</button>
  </form>
{% else %}
  <p class="text-warning">Il link non è più valido. Richiedi un nuovo reset.</p>
{% endif %}
{% endblock %}
```


### templates/django_classified/password_reset_done.html

```html
{% extends "django_classified/_base.html" %}
{% block title %}Email inviata{% endblock %}
{% block body %}
<h3>Controlla la tua casella email</h3>
<p>Se l’indirizzo è registrato, abbiamo inviato un link per reimpostare la password.</p>
{% endblock %}
```


### templates/django_classified/password_reset_form.html

```html
{% extends "django_classified/_base.html" %}
{% block title %}Password reset{% endblock %}
{% block body %}
<h3>Password reset</h3>
<p>Inserisci l’email del tuo account. Riceverai un link per reimpostare la password.</p>
<form method="post">
  {% csrf_token %}
  {{ form.email.errors }}
  <div class="form-group">
    <label for="id_email">Email</label>
    {{ form.email }}
  </div>
  <button class="btn btn-primary" type="submit">Invia</button>
</form>
{% endblock %}
```


### templates/django_classified/profile.html

```html
{% extends "django_classified/_base.html" %}

{% load i18n bootstrap %}

{% block title %}{% trans "Profile" %}{% endblock title %}

{% block body %}
  <div class="row marketing">
    <div class="col-lg-12">
      <form method="post" role="form">
        {% csrf_token %}
        {{ form|bootstrap }}
        <input type="submit" value="{% trans "Update" %}" class="btn btn-default">
      </form>
    </div>
  </div>
{% endblock %}
```


### templates/django_classified/_base.html

```html
{% spaceless %}

  {% load static i18n %}

  <!DOCTYPE HTML>
  <html lang="en">

  <head>
    <title>{% block title %}NINVENDO - A swap and market place for nintendo lovers{% endblock %}</title>

    <meta name="description" content="NINVENDO - A swap and market place for nintendo lovers">>/>
    <meta name="keywords" content="{% block meta_keywords %}{% endblock meta_keywords %}"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% if GOOGLE_SITE_VERIFICATION_ID %}
      <meta name="google-site-verification" content="{{ GOOGLE_SITE_VERIFICATION_ID }}"/>
    {% endif %}
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    {% if FACEBOOK_APP_ID %}
      <meta property="fb:app_id" content="{{ FACEBOOK_APP_ID }}"/>
    {% endif %}
    <meta property="og:type" content="website"/>
    {% block meta_og %}{% endblock %}

    <link rel="icon" type="image/x-icon" href="{% static 'django_classified/images/favicon.ico' %}"/>

    <link href="{% static 'django_classified/css/bootstrap.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'django_classified/css/jumbotron-narrow.css' %}" rel="stylesheet"/>
    <link href="{% static 'django_classified/css/lightbox.min.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'django_classified/css/style.css' %}" rel="stylesheet" type="text/css"/>

    <link rel="alternate" type="application/rss+xml" href="{% url 'django_classified:rss' %}">

  </head>

  <body>
  <div class="container">

    <div class="header clearfix">
      <nav>
        <ul class="nav nav-pills pull-right">
          <li role="presentation" class="active"><a
                  href="{% url 'django_classified:item-new' %}">{% trans "Add new" %}</a>
          </li>
          <li role="presentation"><a href="{% url 'django_classified:index' %}">{% trans "Home" %}</a></li>
          <li role="presentation"><a href="{% url 'django_classified:search' %}">{% trans "Search" %}</a></li>
          {% if user.is_authenticated %}
            <li role="presentation" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <span class="glyphicon glyphicon-user"></span> {{ user.username }} <span class="caret"></span>
              </a>
              
              <ul class="dropdown-menu">
                    <li><a href="{% url 'django_classified:user-items' %}">{% trans "My items" %} ({{ user.item_set.count }})</a></li>
                    <li><a href="{% url 'django_classified:profile' %}">{% trans "Profile" %}</a></li>

                    <!-- 👇 nuovi link scambi -->
                    <li><a href="{% url 'trade:inbox' %}">Scambi (ricevuti)</a></li>
                    <li><a href="{% url 'trade:sent' %}">Scambi (inviati)</a></li>
                    <!-- 👆 -->

                    <li class="divider"></li>
                    <li>
                      <form method="post" action="{% url 'logout' %}" style="margin:0; padding:0;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-link" style="padding: 0; color: #337ab7;">
                          {% trans "Logout" %}
                        </button>
                      </form>
                    </li>


          {% else %}
            <li role="presentation">
              <a href="{% url 'django_classified:profile' %}" title="{% trans "Login" %}">
                <span class="glyphicon glyphicon-user"></span> {% trans "Login" %}
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>
      <h4 class="text-muted"><a href="{% url 'django_classified:index' %}">{{ DCF.SITE_NAME }}</a>
        {% if area_list %}
          &nbsp;
          <small>
            <select id="area-selector">
              <option value="">{% trans 'All areas' %}</option>
              {% for area_item in area_list %}
                <option value="{{ area_item.slug }}" {% if area.pk == area_item.pk %}selected{% endif %}>
                  {{ area_item }}
                </option>
              {% endfor %}
            </select>
          </small>
        {% endif %}
      </h4>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class='row'>
          <div class="col-md-12">
            <div {% if message.tags %} class="alert alert-{{ message.tags }}"{% endif %}>
              <button type="button" class="close" data-dismiss="alert">×</button>
              {{ message|safe }}
            </div>
          </div>
        </div>
      {% endfor %}
    {% endif %}

    {% block body %}

    {% endblock %}

    <footer class="footer">
      <span class="pull-left">{{ DCF.SITE_NAME }}</span>
      {% if DCF.DISPLAY_CREDITS %}
        <span class="pull-right">{% trans "Powered by" %} <a href="https://github.com/slyapustin/NINVENDO"
                                                             title="NINVENDO Ads">NINVENDO Ads (v{{ DCF.VERSION }})</a></span>
      {% endif %}
    </footer>

  </div>

  <script src="{% static 'django_classified/js/jquery-3.3.1.min.js' %}"></script>
  <script src="{% static 'django_classified/js/bootstrap.min.js' %}"></script>
  <script src="{% static 'django_classified/js/lightbox.min.js' %}"></script>

  {% block ext_scripts %}{% endblock %}

  {% if GOOGLE_ANALYTICS_PROPERTY_ID %}
    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

      ga('create', '{{ GOOGLE_ANALYTICS_PROPERTY_ID }}', 'auto');
      ga('send', 'pageview');
    </script>
  {% endif %}

  <script>
    $(function () {
      $('#area-selector').on('change', function () {
        var params = {
          area_slug: this.value,
          next: window.location.href
        };
        window.location = "{% url 'django_classified:set-area' %}?" + $.param(params);
      });
    });
  </script>

  <!-- generated {% now "jS F Y H:i:s" %} -->
  </body>
  </html>
{% endspaceless %}
```


### templates/registration/registration_complete.html

```html
{% extends "django_classified/_base.html" %}
{% load i18n %}

{% block title %}{% trans "Registrazione completata" %}{% endblock %}

{% block body %}
<div class="container" style="max-width:500px; margin-top:30px;">
  <h3>{% trans "Registrazione completata!" %}</h3>
  <p>{% trans "Ora puoi accedere al tuo account con le credenziali scelte." %}</p>
  <a href="{% url 'login' %}" class="btn btn-primary">{% trans "Vai al login" %}</a>
</div>
{% endblock %}
```


### templates/registration/registration_form.html

```html
{% extends "django_classified/_base.html" %}
{% load i18n %}

{% block title %}{% trans "Registrazione" %}{% endblock %}

{% block body %}
<div class="container" style="max-width:500px; margin-top:30px;">
  <h3>{% trans "Crea un nuovo account" %}</h3>

  <form method="post" action="">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="form-group">
      <label for="id_username">{% trans "Username" %}</label>
      {{ form.username }}
      {{ form.username.errors }}
    </div>

    <div class="form-group">
      <label for="id_email">{% trans "Email" %}</label>
      {{ form.email }}
      {{ form.email.errors }}
    </div>

    <div class="form-group">
      <label for="id_password1">{% trans "Password" %}</label>
      {{ form.password1 }}
      {{ form.password1.errors }}
    </div>

    <div class="form-group">
      <label for="id_password2">{% trans "Conferma password" %}</label>
      {{ form.password2 }}
      {{ form.password2.errors }}
    </div>

    <button type="submit" class="btn btn-success btn-block">{% trans "Registrati" %}</button>
  </form>

  <div style="margin-top:15px;">
    <p>{% trans "Hai già un account?" %} <a href="{% url 'login' %}">{% trans "Accedi" %}</a></p>
  </div>
</div>
{% endblock %}
```


### trade/admin.py

```python
from django.contrib import admin

# Register your models here.
from django.contrib import admin
from .models import TradeProposal, TradeFeedback

@admin.register(TradeProposal)
class TradeProposalAdmin(admin.ModelAdmin):
    list_display = ("id", "from_user", "to_user", "offer_item", "want_item", "state", "created_at")
    list_filter = ("state",)
    search_fields = ("from_user__username", "to_user__username")

@admin.register(TradeFeedback)
class TradeFeedbackAdmin(admin.ModelAdmin):
    list_display = ("id", "trade", "rater", "ratee", "rating", "created_at")
    list_filter = ("rating",)
```


### trade/apps.py

```python
from django.apps import AppConfig


class TradeConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'trade'
```


### trade/models.py

```python
from django.db import models

# Create your models here.
from django.conf import settings
from django.db import models
from django_fsm import FSMField, transition

# NB: il modello degli annunci del pacchetto django_classified si chiama "Item"
from django_classified.models import Item

class TradeProposal(models.Model):
    STATE_SENT = "sent"
    STATE_ACCEPTED = "accepted"
    STATE_DECLINED = "declined"
    STATE_CANCELLED = "cancelled"
    STATE_COMPLETED = "completed"

    STATE_CHOICES = [
        (STATE_SENT, "Sent"),
        (STATE_ACCEPTED, "Accepted"),
        (STATE_DECLINED, "Declined"),
        (STATE_CANCELLED, "Cancelled"),
        (STATE_COMPLETED, "Completed"),
    ]

    from_user = models.ForeignKey(
        settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="proposals_sent"
    )
    to_user = models.ForeignKey(
        settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="proposals_received"
    )

    offer_item = models.ForeignKey(
        Item, on_delete=models.PROTECT, related_name="trade_offers"
    )  # annuncio dell'offerente
    want_item = models.ForeignKey(
        Item, on_delete=models.PROTECT, related_name="trade_targets"
    )  # annuncio del destinatario

    message = models.TextField(blank=True)
    created_at = models.DateTimeField(auto_now_add=True)

    state = FSMField(default=STATE_SENT, choices=STATE_CHOICES, protected=True)

    class Meta:
        constraints = [
            # Non puoi proporre uno scambio a te stesso
            models.CheckConstraint(
                check=~models.Q(from_user=models.F("to_user")), name="tp_users_distinct"
            ),
            # Non puoi scambiare lo stesso annuncio con se stesso
            models.CheckConstraint(
                check=~models.Q(offer_item=models.F("want_item")), name="tp_items_distinct"
            ),
        ]
        indexes = [
            models.Index(fields=["to_user", "state"]),
            models.Index(fields=["from_user", "state"]),
        ]

    def __str__(self):
        return f"{self.from_user} → {self.to_user} | {self.offer_item_id} ↔ {self.want_item_id} [{self.state}]"

    # Transizioni (i permessi/ownership li verifichiamo nelle view)
    @transition(field=state, source=STATE_SENT, target=STATE_ACCEPTED)
    def accept(self): pass

    @transition(field=state, source=STATE_SENT, target=STATE_DECLINED)
    def decline(self): pass

    @transition(field=state, source=[STATE_SENT, STATE_ACCEPTED], target=STATE_CANCELLED)
    def cancel(self): pass

    @transition(field=state, source=STATE_ACCEPTED, target=STATE_COMPLETED)
    def complete(self): pass


class TradeFeedback(models.Model):
    trade = models.OneToOneField(TradeProposal, on_delete=models.CASCADE, related_name="feedback")
    rater = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    ratee = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="ratings_received")
    rating = models.PositiveSmallIntegerField()  # 1..5
    comment = models.TextField(blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
```


### trade/urls.py

```python
from django.urls import path
from . import views

app_name = "trade"

urlpatterns = [
    path("inbox/", views.InboxTradesView.as_view(), name="inbox"),
    path("sent/", views.SentTradesView.as_view(), name="sent"),
    path("propose/<int:item_id>/", views.ProposeTradeView.as_view(), name="propose"),
    path("<int:pk>/accept/", views.AcceptTradeView.as_view(), name="accept"),
    path("<int:pk>/decline/", views.DeclineTradeView.as_view(), name="decline"),
    path("<int:pk>/cancel/", views.CancelTradeView.as_view(), name="cancel"),
    path("<int:pk>/complete/", views.CompleteTradeView.as_view(), name="complete"),
]
```


### trade/views.py

```python
from django.shortcuts import render

from django.views import View
from django.views.generic import ListView
from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.mixins import LoginRequiredMixin
from django.http import HttpResponseForbidden
from django.contrib import messages

from .models import TradeProposal
try:
    # modello Annunci del pacchetto classified
    from django_classified.models import Item
except Exception:
    Item = None  # fallback per sviluppo

# Inbox (ricevuti)
class InboxTradesView(LoginRequiredMixin, ListView):
    template_name = "trade/list.html"
    context_object_name = "trades"

    def get_queryset(self):
        return TradeProposal.objects.filter(to_user=self.request.user).order_by("-created_at")

# Inviati
class SentTradesView(LoginRequiredMixin, ListView):
    template_name = "trade/list.html"
    context_object_name = "trades"

    def get_queryset(self):
        return TradeProposal.objects.filter(from_user=self.request.user).order_by("-created_at")

# Proponi scambio
class ProposeTradeView(LoginRequiredMixin, View):
    def get(self, request, item_id):
        want_item = get_object_or_404(Item, pk=item_id)
        if want_item.user == request.user:
            return HttpResponseForbidden("Non puoi proporre scambi a te stesso.")
        return render(request, "trade/propose.html", {"want_item": want_item})

    def post(self, request, item_id):
        want_item = get_object_or_404(Item, pk=item_id)
        if want_item.user == request.user:
            return HttpResponseForbidden("Non puoi proporre scambi a te stesso.")
        # versione minima: crea una finta proposta per test
        # (sostituisci con il form reale appena pronto)
        offer_item_id = request.POST.get("offer_item_id")
        offer_item = get_object_or_404(Item, pk=offer_item_id, user=request.user)
        TradeProposal.objects.create(
            from_user=request.user,
            to_user=want_item.user,
            offer_item=offer_item,
            want_item=want_item,
            message=request.POST.get("message", "")
        )
        messages.success(request, "Proposta inviata.")
        return redirect("trade:sent")

# Azioni di stato (stub, POST-only)
class AcceptTradeView(LoginRequiredMixin, View):
    def post(self, request, pk):
        tp = get_object_or_404(TradeProposal, pk=pk, to_user=request.user)
        tp.accept(); tp.save()
        messages.success(request, "Proposta accettata.")
        return redirect("trade:inbox")

class DeclineTradeView(LoginRequiredMixin, View):
    def post(self, request, pk):
        tp = get_object_or_404(TradeProposal, pk=pk, to_user=request.user)
        tp.decline(); tp.save()
        messages.info(request, "Proposta rifiutata.")
        return redirect("trade:inbox")

class CancelTradeView(LoginRequiredMixin, View):
    def post(self, request, pk):
        tp = get_object_or_404(TradeProposal, pk=pk)
        if tp.from_user != request.user and tp.to_user != request.user:
            return HttpResponseForbidden()
        tp.cancel(); tp.save()
        messages.warning(request, "Proposta annullata.")
        return redirect("trade:sent")

class CompleteTradeView(LoginRequiredMixin, View):
    def post(self, request, pk):
        tp = get_object_or_404(TradeProposal, pk=pk)
        if tp.from_user != request.user and tp.to_user != request.user:
            return HttpResponseForbidden()
        tp.complete(); tp.save()
        messages.success(request, "Scambio completato.")
        return redirect("trade:inbox")
```